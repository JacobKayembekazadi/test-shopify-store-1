{%- liquid
  assign product = product | default: all_products[section.settings.product]
-%}

<div class="product-extra-content section-spacing" data-section-id="{{ section.id }}">
  <div class="container">
    <div class="product-extra-content__wrapper">
      <!-- Product Story -->
      {%- if section.settings.show_story and section.settings.story_title != blank -%}
        <div class="product-extra-content__section product-extra-content__story">
          <h2 class="product-extra-content__title">{{ section.settings.story_title }}</h2>
          {%- if section.settings.story_content != blank -%}
            <div class="product-extra-content__content">
              {{ section.settings.story_content }}
            </div>
          {%- endif -%}
          {%- if section.settings.story_image != blank -%}
            <div class="product-extra-content__image">
              <img
                src="{{ section.settings.story_image | image_url: width: 1200 }}"
                alt="{{ section.settings.story_image.alt | escape }}"
                width="1200"
                height="800"
                loading="lazy"
              >
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}

      <!-- FAQs -->
      {%- if section.settings.show_faqs -%}
        <div class="product-extra-content__section product-extra-content__faqs">
          <h2 class="product-extra-content__title">{{ section.settings.faqs_title | default: 'Frequently Asked Questions' }}</h2>
          <div class="product-extra-content__faqs-list">
            {%- for block in section.blocks -%}
              {%- if block.type == 'faq' -%}
                <div class="product-extra-content__faq" {{ block.shopify_attributes }}>
                  <button
                    type="button"
                    class="product-extra-content__faq-question"
                    data-faq-toggle
                    aria-expanded="false"
                  >
                    <span>{{ block.settings.question }}</span>
                    <svg class="product-extra-content__faq-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <path d="M5 7.5l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <div class="product-extra-content__faq-answer" data-faq-answer>
                    <div class="product-extra-content__faq-answer-content">
                      {{ block.settings.answer }}
                    </div>
                  </div>
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}

      <!-- Specifications -->
      {%- if section.settings.show_specifications and section.settings.specifications_content != blank -%}
        <div class="product-extra-content__section product-extra-content__specifications">
          <h2 class="product-extra-content__title">{{ section.settings.specifications_title | default: 'Specifications' }}</h2>
          <div class="product-extra-content__content">
            {{ section.settings.specifications_content }}
          </div>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
  .product-extra-content {
    padding-top: 4rem;
    padding-bottom: 4rem;
    border-top: 1px solid var(--color-border-soft);
  }

  .product-extra-content__wrapper {
    display: flex;
    flex-direction: column;
    gap: 4rem;
    max-width: 800px;
    margin: 0 auto;
  }

  .product-extra-content__title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 1.5rem;
  }

  .product-extra-content__content {
    color: var(--color-text-secondary);
    line-height: 1.8;
    font-size: 1rem;
  }

  .product-extra-content__content h3,
  .product-extra-content__content h4 {
    font-family: 'Space Grotesk', sans-serif;
    color: var(--color-text-primary);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .product-extra-content__content ul,
  .product-extra-content__content ol {
    padding-left: 1.5rem;
    margin: 1rem 0;
  }

  .product-extra-content__content li {
    margin: 0.5rem 0;
  }

  .product-extra-content__image {
    margin-top: 2rem;
    border-radius: 1rem;
    overflow: hidden;
  }

  .product-extra-content__image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .product-extra-content__faqs-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .product-extra-content__faq {
    border: 2px solid var(--color-border-soft);
    border-radius: 0.5rem;
    overflow: hidden;
    background-color: var(--color-bg-elevated);
  }

  .product-extra-content__faq-question {
    width: 100%;
    padding: 1.25rem 1.5rem;
    background: none;
    border: none;
    text-align: left;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text-primary);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    transition: background-color 0.3s ease;
  }

  .product-extra-content__faq-question:hover {
    background-color: var(--color-bg-section-soft);
  }

  .product-extra-content__faq-icon {
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .product-extra-content__faq-question[aria-expanded="true"] .product-extra-content__faq-icon {
    transform: rotate(180deg);
  }

  .product-extra-content__faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .product-extra-content__faq-answer-content {
    padding: 0 1.5rem 1.25rem;
    color: var(--color-text-secondary);
    line-height: 1.8;
  }

  .product-extra-content__faq-question[aria-expanded="true"] + .product-extra-content__faq-answer {
    max-height: 1000px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const faqToggles = document.querySelectorAll('[data-faq-toggle]');
    
    faqToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        const answer = this.nextElementSibling;
        
        // Close all other FAQs
        faqToggles.forEach(otherToggle => {
          if (otherToggle !== this) {
            otherToggle.setAttribute('aria-expanded', 'false');
            const otherAnswer = otherToggle.nextElementSibling;
            if (otherAnswer) {
              otherAnswer.style.maxHeight = '0';
            }
          }
        });
        
        // Toggle current FAQ
        this.setAttribute('aria-expanded', !isExpanded);
        if (answer) {
          if (!isExpanded) {
            answer.style.maxHeight = answer.scrollHeight + 'px';
          } else {
            answer.style.maxHeight = '0';
          }
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product Extra Content",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Product Story"
    },
    {
      "type": "checkbox",
      "id": "show_story",
      "label": "Show product story",
      "default": true
    },
    {
      "type": "text",
      "id": "story_title",
      "label": "Story title",
      "default": "Our Story"
    },
    {
      "type": "richtext",
      "id": "story_content",
      "label": "Story content"
    },
    {
      "type": "image_picker",
      "id": "story_image",
      "label": "Story image"
    },
    {
      "type": "header",
      "content": "FAQs"
    },
    {
      "type": "checkbox",
      "id": "show_faqs",
      "label": "Show FAQs",
      "default": true
    },
    {
      "type": "text",
      "id": "faqs_title",
      "label": "FAQs title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "header",
      "content": "Specifications"
    },
    {
      "type": "checkbox",
      "id": "show_specifications",
      "label": "Show specifications",
      "default": false
    },
    {
      "type": "text",
      "id": "specifications_title",
      "label": "Specifications title",
      "default": "Specifications"
    },
    {
      "type": "richtext",
      "id": "specifications_content",
      "label": "Specifications content"
    }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "FAQ",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>We offer a 30-day money-back guarantee on all products.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Extra Content",
      "blocks": [
        {
          "type": "faq",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We offer a 30-day money-back guarantee on all products.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "<p>Standard shipping takes 5-7 business days. Express shipping is available for an additional fee.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Do you offer international shipping?",
            "answer": "<p>Yes, we ship worldwide. Shipping costs and delivery times vary by location.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

